# ç”Ÿäº§ä¼˜åŒ–å¿«é€Ÿå‚è€ƒæŒ‡å—

**ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-01-07  
**é€‚ç”¨äº**: YLAI-AUTO-PLATFORM v1.7.0+  

---

## âš¡ å¿«é€Ÿå¯åŠ¨

### 1. åˆæ¬¡ç¯å¢ƒè®¾ç½® (5 åˆ†é’Ÿ)

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/xiedaima/æ¡Œé¢/OOO/YLAI-AUTO-PLATFORM

# 2. åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ
python3 -m venv .venv

# 3. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate  # Linux/Mac
# æˆ–
.venv\Scripts\activate     # Windows

# 4. å®‰è£…ä¾èµ–
pip install -r backend/requirements.txt -q

# 5. å®‰è£…ç¼ºå¤±çš„åŒ… (å¦‚æœéœ€è¦)
pip install prometheus-client structlog -q
```

### 2. å¯åŠ¨åç«¯æœåŠ¡ (2 åˆ†é’Ÿ)

```bash
# å¼€å‘æ¨¡å¼ï¼ˆå¸¦è‡ªåŠ¨é‡è½½ï¼‰
python -m uvicorn backend.app:app --host 127.0.0.1 --port 8001 --reload

# ç”Ÿäº§æ¨¡å¼ï¼ˆå¤š workerï¼‰
python -m uvicorn backend.app:app --host 0.0.0.0 --port 8001 --workers 4
```

### 3. éªŒè¯ç³»ç»Ÿè¿è¡Œ

```bash
# å¿«é€Ÿæ£€æŸ¥
curl http://127.0.0.1:8001/health?fast=true

# æŸ¥çœ‹è„šæœ¬åˆ—è¡¨
curl http://127.0.0.1:8001/scripts

# æ‰“å¼€ Swagger æ–‡æ¡£
open http://127.0.0.1:8001/docs  # Mac
xdg-open http://127.0.0.1:8001/docs  # Linux
```

---

## ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µé€ŸæŸ¥

### API å“åº”æ ¼å¼

æ‰€æœ‰ API ç«¯ç‚¹éƒ½è¿”å›ç»Ÿä¸€æ ¼å¼:

```json
{
    "code": 0,                              // 0 = æˆåŠŸ, é 0 = é”™è¯¯
    "message": "æè¿°æ–‡å­—",                  // äººç±»å¯è¯»çš„æ¶ˆæ¯
    "data": { ... },                       // å®é™…è¿”å›æ•°æ®
    "timestamp": "2026-01-07T...",        // æœåŠ¡å™¨æ—¶é—´æˆ³
    "request_id": null,                   // å¯é€‰ï¼šè¯·æ±‚è¿½è¸ª ID
    "pagination": null                    // å¯é€‰ï¼šåˆ†é¡µä¿¡æ¯
}
```

### é”™è¯¯ç ä¸€è§ˆ

| èŒƒå›´ | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| 0 | âœ… æˆåŠŸ | ä»»ä½•æˆåŠŸå“åº” |
| 1000-1099 | å®¢æˆ·ç«¯é”™è¯¯ | VALIDATION_ERROR (1001) |
| 2000-2099 | æœåŠ¡å™¨é”™è¯¯ | INTERNAL_ERROR (2000) |
| 3000-3099 | ä¸šåŠ¡é”™è¯¯ | UNAUTHORIZED (3001) |

### å“åº”ç±»å¿«é€Ÿç”¨æ³•

```python
from backend.core.response import SuccessResponse, ErrorResponse, ErrorCode

# âœ… æˆåŠŸå“åº”
return SuccessResponse(data={"count": 10}, message="Success")

# âŒ é”™è¯¯å“åº”
return ErrorResponse(code=ErrorCode.NOT_FOUND, message="Resource not found")

# ğŸ“„ åˆ†é¡µå“åº”
return PaginatedResponse(
    data=items,
    message="Retrieved items",
    total=100,
    page=1,
    page_size=10
)
```

---

## ğŸ“ å¸¸ç”¨å¼€å‘ä»»åŠ¡

### æ·»åŠ æ–°çš„ API ç«¯ç‚¹

```python
# 1. åœ¨å¯¹åº”çš„ router æ–‡ä»¶ä¸­æ·»åŠ ï¼ˆå¦‚ backend/api/base_router.pyï¼‰
from fastapi import APIRouter
from backend.core.response import SuccessResponse, ErrorResponse, ErrorCode

router = APIRouter()

@router.get("/api/your-endpoint")
def your_endpoint():
    try:
        # ä¸šåŠ¡é€»è¾‘
        return SuccessResponse(data={"result": "..."}, message="Success")
    except Exception as e:
        return ErrorResponse(code=ErrorCode.INTERNAL_ERROR, message=str(e))

# 2. åœ¨ router_registry.py ä¸­æ³¨å†Œï¼ˆå¦‚æœéœ€è¦ï¼‰
# å¦‚æœå·²åœ¨ ROUTER_REGISTRY ä¸­ï¼Œä¼šè‡ªåŠ¨æ³¨å†Œ
```

### åœ¨å‰ç«¯è°ƒç”¨æ–° API

```javascript
// 1. å¯¼å…¥ apiClient
import { apiClient } from '@/api/client'

// 2. åœ¨ç»„ä»¶ä¸­è°ƒç”¨
export default {
  async mounted() {
    try {
      const response = await apiClient.get('/api/your-endpoint')
      // response.data å·²ç»æ˜¯è§£æåçš„æ•°æ®
      this.result = response?.data
    } catch (err) {
      console.error('API call failed:', err)
      this.$message.error(err.message)
    }
  }
}
```

### æ·»åŠ è®¤è¯å’Œæƒé™æ£€æŸ¥

```python
from backend.api.auth import require_perm

# åœ¨è·¯ç”±ä¸­æ·»åŠ æƒé™æ£€æŸ¥
@router.get("/api/protected-endpoint")
def protected(request: Request, _auth=Depends(require_perm("admin"))):
    # åªæœ‰ admin æƒé™çš„ç”¨æˆ·æ‰èƒ½è®¿é—®
    return SuccessResponse(data={...})
```

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜é€Ÿè§£

### é—®é¢˜ 1: "ModuleNotFoundError: No module named 'xxx'"

**è§£å†³**:
```bash
pip install xxx
# æˆ–è€…æŸ¥çœ‹æ˜¯å¦é—æ¼äº†ä¾èµ–
pip install -r backend/requirements.txt --upgrade
```

### é—®é¢˜ 2: ç«¯å£ 8001 å·²è¢«å ç”¨

**è§£å†³**:
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :8001

# æ€æ­»è¿›ç¨‹
kill -9 <PID>

# æˆ–ä½¿ç”¨å¦ä¸€ä¸ªç«¯å£
python -m uvicorn backend.app:app --port 8002
```

### é—®é¢˜ 3: å‰ç«¯æ— æ³•è¿æ¥åç«¯ API

**æ£€æŸ¥æ¸…å•**:
- [ ] åç«¯æ˜¯å¦å¯åŠ¨ï¼Ÿ `curl http://127.0.0.1:8001/health`
- [ ] å‰ç«¯ `.env.development` ä¸­ `VITE_API_BASE_URL` æ˜¯å¦æ­£ç¡®ï¼Ÿ
- [ ] æµè§ˆå™¨æ˜¯å¦æŠ¥ CORS é”™è¯¯ï¼Ÿ(æ£€æŸ¥å¼€å‘è€…å·¥å…·)
- [ ] é˜²ç«å¢™æ˜¯å¦é˜»æ­¢äº† 8001 ç«¯å£ï¼Ÿ

### é—®é¢˜ 4: æ•°æ®åº“è¿æ¥å¤±è´¥

**æ£€æŸ¥**:
```bash
# 1. æŸ¥çœ‹æ•°æ®åº“é…ç½®
cat backend/.env.development | grep DATABASE

# 2. æµ‹è¯•è¿æ¥
python -c "from sqlalchemy import create_engine; engine = create_engine('...'); print('OK')"
```

---

## ğŸ“Š æ€§èƒ½æ£€æŸ¥æ¸…å•

### æ¯å¤©éƒ½åº”è¯¥åšçš„æ£€æŸ¥

```bash
# 1. å¥åº·æ£€æŸ¥ï¼ˆåº”è¿”å› code=0ï¼‰
curl http://127.0.0.1:8001/health?fast=true | jq '.code'

# 2. é”™è¯¯æ—¥å¿—æ£€æŸ¥
tail -50 logs/*.log | grep ERROR

# 3. å“åº”æ—¶é—´æ£€æŸ¥ï¼ˆåº” < 100msï¼‰
time curl http://127.0.0.1:8001/health?fast=true

# 4. è·¯ç”±æ³¨å†Œæ£€æŸ¥ï¼ˆåº”åˆ—å‡ºæ‰€æœ‰è·¯ç”±ï¼‰
curl http://127.0.0.1:8001/docs | grep -c '"path":'
```

### å®šæœŸæ‰§è¡Œçš„ç»´æŠ¤

| ä»»åŠ¡ | é¢‘ç‡ | å‘½ä»¤ |
|------|------|------|
| ä¾èµ–æ›´æ–°æ£€æŸ¥ | å‘¨ | `pip list --outdated` |
| æ—¥å¿—æ¸…ç† | æœˆ | `rm -f logs/*.log.old` |
| æ•°æ®åº“ä¼˜åŒ– | æœˆ | `VACUUM` (æ•°æ®åº“ç‰¹å®š) |
| ç¼“å­˜æ¸…ç† | å‘¨ | `redis-cli FLUSHALL` |

---

## ğŸ”„ Git å·¥ä½œæµ

### åˆ›å»ºæ–°åŠŸèƒ½åˆ†æ”¯

```bash
# 1. ä» main åˆ›å»ºæ–°åˆ†æ”¯
git checkout -b feature/api-response-format

# 2. åœ¨æœ¬åœ°å¼€å‘å’Œæµ‹è¯•
python -m uvicorn backend.app:app --reload

# 3. æäº¤æ›´æ”¹
git add .
git commit -m "feat: add new API endpoint with standard response format"

# 4. æ¨é€åˆ†æ”¯
git push origin feature/api-response-format

# 5. åˆ›å»º Pull Requestï¼ˆåœ¨ GitHub ä¸Šï¼‰
```

### ä»£ç å®¡æŸ¥æ£€æŸ¥é¡¹

- [ ] ä»£ç æ˜¯å¦éµå¾ªé¡¹ç›®é£æ ¼æŒ‡å—ï¼Ÿ
- [ ] API æ˜¯å¦ä½¿ç”¨äº†ç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼Ÿ
- [ ] æ˜¯å¦æœ‰ç›¸åº”çš„å•å…ƒæµ‹è¯•ï¼Ÿ
- [ ] æ˜¯å¦æ›´æ–°äº†ç›¸å…³æ–‡æ¡£ï¼Ÿ
- [ ] å‰ç«¯å’Œåç«¯çš„æ”¹å˜æ˜¯å¦åŒ¹é…ï¼Ÿ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£å¿«é€Ÿé“¾æ¥

| æ–‡æ¡£ | ç”¨é€” |
|------|------|
| [ç”Ÿäº§ä¼˜åŒ–æ‰§è¡ŒæŠ¥å‘Š](ç”Ÿäº§ä¼˜åŒ–æ‰§è¡ŒæŠ¥å‘Š.md) | äº†è§£é¡¹ç›®ç°çŠ¶å’Œæˆæœ |
| [ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’](ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’.md) | æŸ¥çœ‹å¾…åšé¡¹å’Œä¼˜å…ˆçº§ |
| [ç¬¬äºŒæ¢¯é˜Ÿä¼˜åŒ–æ‰§è¡Œæ€»ç»“](ç¬¬äºŒæ¢¯é˜Ÿä¼˜åŒ–æ‰§è¡Œæ€»ç»“.md) | æ·±å…¥äº†è§£ API å‡çº§ç»†èŠ‚ |
| [å…¨å±€æ•´ç†ä¼˜åŒ–æŠ¥å‘Š](å…¨å±€æ•´ç†ä¼˜åŒ–æŠ¥å‘Š.md) | äº†è§£å®Œæ•´çš„ä¼˜åŒ–æ¡†æ¶ |

---

## ğŸ“ å­¦ä¹ èµ„æº

### æ–°åŠ å…¥å›¢é˜Ÿæˆå‘˜åº”è¯¥è¯»

1. [YLAI-AUTO-PLATFORM é¡¹ç›® README](../README.md)
2. [API å“åº”æ ¼å¼è¯´æ˜](#api-å“åº”æ ¼å¼) (æœ¬æ–‡æ¡£)
3. [ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’](ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’.md) (äº†è§£è¿›å±•)

### å¼€å‘æ—¶åº”è¯¥å‚è€ƒ

- [FastAPI å®˜æ–¹æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [Vue.js 3 å®˜æ–¹æ–‡æ¡£](https://vuejs.org/)
- [Pydantic å®˜æ–¹æ–‡æ¡£](https://docs.pydantic.dev/)

### è°ƒè¯•å’Œæ•…éšœæ’é™¤

- åç«¯æ—¥å¿—: `tail -f logs/backend.log`
- å‰ç«¯æ§åˆ¶å°: F12 â†’ Console
- ç½‘ç»œè¿½è¸ª: F12 â†’ Network

---

## âŒ¨ï¸ å¿«é€Ÿå‘½ä»¤é€ŸæŸ¥è¡¨

```bash
# åç«¯ç›¸å…³
uvicorn backend.app:app --reload          # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pytest backend/tests/ -v                  # è¿è¡Œæµ‹è¯•
black backend/ --check                    # æ£€æŸ¥ä»£ç æ ¼å¼
isort backend/ --check                    # æ£€æŸ¥å¯¼å…¥æ’åº
mypy backend/ --ignore-missing-imports    # ç±»å‹æ£€æŸ¥

# å‰ç«¯ç›¸å…³
npm install                                # å®‰è£…ä¾èµ–
npm run dev                                # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run build                              # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run lint                               # è¿è¡Œ linter

# Docker ç›¸å…³
docker-compose up -d                       # å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose logs -f api                 # æŸ¥çœ‹ API æ—¥å¿—
docker-compose down                        # åœæ­¢æ‰€æœ‰æœåŠ¡
docker build -t ylai:latest .              # æ„å»ºé•œåƒ

# Git ç›¸å…³
git status                                 # æŸ¥çœ‹çŠ¶æ€
git diff                                   # æŸ¥çœ‹å˜æ›´
git commit -am "msg"                       # æäº¤å˜æ›´
git push origin main                       # æ¨é€åˆ°è¿œç«¯
```

---

## ğŸ†˜ æ±‚åŠ©å’Œåé¦ˆ

### é‡åˆ°é—®é¢˜æ€ä¹ˆåŠ

1. **æŸ¥çœ‹æ—¥å¿—**: `tail -f logs/*.log`
2. **æœç´¢æ–‡æ¡£**: åœ¨æœ¬ç›®å½•æŸ¥æ‰¾ç›¸å…³ .md æ–‡ä»¶
3. **æäº¤ Issue**: GitHub Issues (åŒ…å«é”™è¯¯æ—¥å¿—å’Œå¤ç°æ­¥éª¤)
4. **è”ç³»å›¢é˜Ÿ**: Slack #ylai-dev é¢‘é“

### åé¦ˆå’Œå»ºè®®

- åŠŸèƒ½è¯·æ±‚: æäº¤ GitHub Discussions
- æ–‡æ¡£æ”¹è¿›: ç¼–è¾‘æœ¬æ–‡ä»¶å¹¶æäº¤ PR
- æ€§èƒ½ä¼˜åŒ–: è”ç³»æŠ€æœ¯ä¸»ç®¡

---

## ğŸ“‹ æ—¥å¸¸å·¥ä½œæ¸…å•

### å¼€å‘è€…æ¯æ—¥å¼€å§‹æ—¶

```
- [ ] æ£€æŸ¥é‚®ä»¶å’Œ Slack æ¶ˆæ¯
- [ ] è¿è¡Œå¥åº·æ£€æŸ¥: curl http://127.0.0.1:8001/health
- [ ] æ‹‰å–æœ€æ–°ä»£ç : git pull
- [ ] å®‰è£…æ–°ä¾èµ–: pip install -r backend/requirements.txt
- [ ] å¯åŠ¨å¼€å‘æœåŠ¡å™¨: uvicorn backend.app:app --reload
```

### æäº¤ä»£ç å‰

```
- [ ] é€šè¿‡æ‰€æœ‰å•å…ƒæµ‹è¯•: pytest backend/
- [ ] ä»£ç æ ¼å¼æ£€æŸ¥: black backend/
- [ ] å¯¼å…¥æ’åº: isort backend/
- [ ] ç±»å‹æ£€æŸ¥: mypy backend/
- [ ] æ›´æ–°ç›¸å…³æ–‡æ¡£
- [ ] åœ¨æœ¬åœ°å®Œæ•´æµ‹è¯•åŠŸèƒ½
```

### éƒ¨ç½²å‰

```
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ (100% ç»¿è‰²)
- [ ] æ–‡æ¡£å·²æ›´æ–°
- [ ] å‘å¸ƒè¯´æ˜å·²å‡†å¤‡
- [ ] æ€§èƒ½åŸºå‡†å·²éªŒè¯
```

---

## ğŸ“ å¸®åŠ©å’Œæ”¯æŒ

- **æŠ€æœ¯æ”¯æŒ**: tech-support@ylai.ai
- **é¡¹ç›®ç»ç†**: pm@ylai.ai
- **Slack**: #ylai-dev, #ylai-help
- **ç´§æ€¥é—®é¢˜**: ç›´æ¥è”ç³»æŠ€æœ¯ä¸»ç®¡

---

**æ›´æ–°æ—¥å¿—**: 
- 2025-01-07: åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- éšæ—¶æ›´æ–°ï¼Œæ— éœ€é€šçŸ¥

**ç»´æŠ¤è€…**: YLAI å¼€å‘å›¢é˜Ÿ  
**ä¸‹æ¬¡å®¡æŸ¥**: 2025-01-14

