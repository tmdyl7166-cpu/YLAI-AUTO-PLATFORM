# YLAI-AUTO-PLATFORM 网页架构和域名配置文档

## 概述

本系统采用前后端分离架构，使用 Vue 3 SPA（单页应用）作为前端，FastAPI 作为后端服务。

## 网络拓扑

```
┌─────────────────────────────────────────────────────┐
│         浏览器 / 用户客户端                           │
│  (localhost:3001 或 127.0.0.1:3001)                 │
└──────────────────┬──────────────────────────────────┘
                   │
        ┌──────────┴──────────┐
        │                     │
        ▼                     ▼
   前端服务器          后端 API 服务器
   (Vite Dev)         (FastAPI)
   :3001              :8001
   ┌──────────────────────────────────────┐
   │ - 路由和 SPA 渲染                     │
   │ - 静态资源服务                       │
   │ - WebSocket 连接（通过代理）         │
   │ - API 调用代理转发到 :8001           │
   └──────────────────────────────────────┘
                   │
                   │ /api 代理
                   ▼
   ┌──────────────────────────────────────┐
   │ FastAPI 后端服务 (127.0.0.1:8001)   │
   │ - REST API 端点                      │
   │ - WebSocket 端点                     │
   │ - 静态页面服务 (/pages)              │
   │ - 数据处理和业务逻辑                 │
   └──────────────────────────────────────┘
```

## 域名和端口配置

### 前端服务器 (Frontend)
- **地址**: `http://localhost:3001` 或 `http://127.0.0.1:3001`
- **服务器**: Vite 开发服务器
- **功能**:
  - 提供 Vue 3 SPA 应用
  - 路由和页面导航
  - API 请求代理转发

### 后端服务器 (Backend)
- **地址**: `http://127.0.0.1:8001`
- **框架**: FastAPI + Uvicorn
- **主要端点**:
  - `/api/*` - REST API 接口
  - `/ws/*` - WebSocket 端点
  - `/pages/*` - 静态 HTML 页面
  - `/health` - 健康检查

## 前端页面完整清单

### 已实现的页面

| 路由 | 文件 | 功能 | 状态 |
|------|------|------|------|
| `/` | `index.vue` | 首页/仪表板 | ✓ 可用 |
| `/run` | `run.vue` | 运行任务中心 | ✓ 可用 |
| `/monitor` | `monitor.vue` | 监控面板 | ✓ 可用 |
| `/api-doc` | `api-doc.vue` | API 文档 | ✓ 可用 |
| `/api-map` | `api-map.vue` | 接口映射 | ✓ 可用 |
| `/visual-pipeline` | `visual_pipeline.vue` | DAG 可视化编排 | ✓ 可用 |
| `/rbac` | `rbac.vue` | 权限管理 (RBAC) | ✓ 可用 |
| `/settings` | `settings.vue` | 系统设置 | ✓ 可用 |
| `/about` | `about.vue` | 关于系统 | ✓ 可用 |
| `/history` | `history.vue` | 历史记录 | ✓ 可用 |
| `/stats` | `stats.vue` | 统计分析 | ✓ 可用 |
| `/user` | `user.vue` | 用户管理 | ✓ 可用 |
| `/login` | `login.vue` | 系统登录 | ✓ 可用 |

## 页面功能模块

### 首页 (/)
**主要模块**:
- 任务中心 (TaskCenterPlaceholder)
- 参数部署 (ParamDeployPlaceholder)
- 调度器 (SchedulerPlaceholder)
- 采集任务 (CollectTaskPlaceholder)
- 枚举任务 (EnumTaskPlaceholder)
- 识别任务 (IdentifyTaskPlaceholder)
- 破解任务 (CrackTaskPlaceholder)
- 自动状态 (AutoStatusPlaceholder)
- 日志管理 (LogManagePlaceholder)
- 工作流部署 (WorkflowDeployPlaceholder)
- 高级功能 (AdvancedFeaturePlaceholder)
- 系统设置 (SystemSettingsPlaceholder)

### 运行任务中心 (/run)
**主要模块**:
- AI 演示面板 (AiDemoPanel)
- 参数部署 (ParamDeployPlaceholder)
- 采集任务 (CollectTaskPlaceholder)
- 识别任务 (IdentifyTaskPlaceholder)
- 破解任务 (CrackTaskPlaceholder)
- 任务表单 (创建新任务)

### 监控面板 (/monitor)
**主要模块**:
- 系统状态指标
- API 调用统计
- 内存使用情况
- CPU 使用率
- 自动状态 (AutoStatusPlaceholder)
- 日志管理 (LogManagePlaceholder)
- 工作流部署 (WorkflowDeployPlaceholder)

### API 文档 (/api-doc)
**主要模块**:
- API 映射面板 (ApiMapPanel)
- 参数部署 (ParamDeployPlaceholder)
- API 列表和文档

### DAG 可视化编排 (/visual-pipeline)
**主要模块**:
- 节点类型面板
- 画布区域
- 流水线节点编辑
- 节点连接和编排

### 权限管理 (/rbac)
**主要模块**:
- 用户管理
- 角色管理
- 权限配置
- 系统设置 (SystemSettingsPlaceholder)

## 域名指向一致性

### 统一的访问方式

**推荐使用**:
```
前端: http://localhost:3001
     或
     http://127.0.0.1:3001
```

**避免混用**:
- ❌ 不要混合使用 `localhost` 和 `127.0.0.1`
- ❌ 不要直接访问 `0.0.0.0`
- ❌ 不要在不同页面使用不同的域名

### 后端 API 配置

Vite 开发服务器自动代理 `/api` 请求到后端:
```javascript
proxy: {
  '/api': {
    target: 'http://127.0.0.1:8001',
    changeOrigin: true,
    secure: false,
    ws: true
  }
}
```

## 页面联动性配置

### 路由导航

所有页面通过 Vue Router 进行客户端导航：
```javascript
<router-link to="/run">运行任务</router-link>
<router-link to="/monitor">监控面板</router-link>
```

### 应用程序导航栏 (App.vue)

全局导航栏包含主要页面链接，支持：
- 当前页面高亮显示
- 响应式设计
- 登录页面隐藏导航

### 跨页面通信

使用 Pinia 状态管理实现页面间数据共享（可选）：
```javascript
// 使用 Pinia store 进行全局状态管理
import { defineStore } from 'pinia'
```

## API 调用统一管理

前端 API 客户端位置: `/frontend/src/api/client.js`

**主要特性**:
- 自动重试机制
- 错误处理
- 认证令牌管理
- 请求/响应拦截器

**使用示例**:
```javascript
import { api } from '@/api/client'

// 获取任务列表
const tasks = await api.getTasks()

// 执行脚本
const result = await api.runScript(scriptId, params)
```

## 系统配置文件

### 全局配置
**文件**: `/frontend/src/config/index.js`

包含：
- API 端点定义
- 权限和角色配置
- HTTP 状态码映射
- 错误消息国际化

### Vite 配置
**文件**: `/frontend/vite.config.js`

关键配置：
- 开发服务器设置 (端口 3001)
- API 代理配置
- 路径别名 (@/ 映射到 src/)
- PWA 配置
- 构建选项

## 部署建议

### 开发环境

```bash
# 启动前端开发服务器 (端口 3001)
cd frontend && npm run dev

# 启动后端 API 服务器 (端口 8001)
cd backend && python -m uvicorn backend.app:app --reload
```

### 生产环境

1. **构建前端**:
```bash
cd frontend && npm run build
```

2. **部署到服务器**:
```bash
# 后端服务将静态文件从 frontend/dist 提供服务
python -m uvicorn backend.app:app --host 0.0.0.0 --port 8001
```

3. **配置反向代理** (Nginx 示例):
```nginx
server {
    listen 80;
    server_name example.com;

    # 前端 SPA
    location / {
        try_files $uri $uri/ /index.html;
        proxy_pass http://127.0.0.1:8001;
    }

    # API 代理
    location /api {
        proxy_pass http://127.0.0.1:8001;
        proxy_redirect off;
    }

    # WebSocket 支持
    location /ws {
        proxy_pass http://127.0.0.1:8001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

## 故障排查

### 页面无法访问

1. **检查前端服务器**:
```bash
curl http://localhost:3001/
```

2. **检查后端服务器**:
```bash
curl http://127.0.0.1:8001/health
```

3. **检查 API 代理**:
```bash
curl http://localhost:3001/api/health
```

### 路由导航不工作

- 确保 `/run` 和其他路由在 `router/index.js` 中定义
- 检查 `configureServer` 中的 history API 回退配置
- 查看浏览器控制台的错误信息

### 样式或资源加载失败

- 检查路径别名 (@/) 配置
- 确保 Vite 配置中的 `resolve.alias` 正确
- 清空浏览器缓存重新加载

## 相关文件

| 文件路径 | 说明 |
|---------|------|
| `frontend/src/router/index.js` | 路由定义 |
| `frontend/src/App.vue` | 全局应用组件 |
| `frontend/src/api/client.js` | API 客户端 |
| `frontend/src/config/index.js` | 全局配置 |
| `frontend/vite.config.js` | Vite 配置 |
| `backend/app.py` | 后端应用入口 |
| `scripts/check_frontend_pages.sh` | 页面检查脚本 |

## 更新日志

### 2025-12-23

✓ 修复了 SPA 路由问题，实现了 history API 回退
✓ 添加了完整的页面导航和路由配置
✓ 创建了统一的 API 客户端和配置管理
✓ 实现了全局导航栏和页面联动
✓ 文档化了所有页面功能和模块
✓ 提供了部署和故障排查指南
