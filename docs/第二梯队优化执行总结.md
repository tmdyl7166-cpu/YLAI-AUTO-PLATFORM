# ç¬¬äºŒæ¢¯é˜Ÿä¼˜åŒ–æ‰§è¡Œæ€»ç»“

**æ‰§è¡Œæ—¥æœŸ**: 2025-01-07  
**ç‰ˆæœ¬**: v1.1  
**çŠ¶æ€**: âœ… éƒ¨åˆ†å®Œæˆï¼ˆå·²äº¤ä»˜å…³é”®ç”Ÿäº§ä¼˜åŒ–ï¼‰

---

## ğŸ“‹ æ‰§è¡Œæ¦‚è§ˆ

ç»§ç»­ç¬¬ä¸€æ¢¯é˜Ÿä¼˜åŒ–å®Œæˆåï¼Œå¯¹åç«¯ API å“åº”æ ¼å¼å’Œå‰ç«¯é›†æˆè¿›è¡Œäº†å®é™…ç”Ÿäº§ä¼˜åŒ–ï¼Œå¹¶æˆåŠŸéªŒè¯ç³»ç»Ÿå¯åŠ¨ã€‚

### å…³é”®æˆæœ

| é¡¹ç›® | çŠ¶æ€ | è¯¦æƒ… |
|------|------|------|
| **åç«¯ `/health` å‡çº§** | âœ… å®Œæˆ | è¿ç§»åˆ°ç»Ÿä¸€å“åº”æ ¼å¼ (v1.1)ï¼ŒåŒ…å«å®Œæ•´çš„ç³»ç»Ÿå¥åº·æ£€æŸ¥é€»è¾‘ |
| **åç«¯ `/scripts` å‡çº§** | âœ… å®Œæˆ | è¿ç§»åˆ°ç»Ÿä¸€å“åº”æ ¼å¼ï¼Œå¢åŠ è„šæœ¬è®¡æ•° |
| **åç«¯ API å¯åŠ¨éªŒè¯** | âœ… å®Œæˆ | æ‰€æœ‰å…³é”®è·¯ç”±æˆåŠŸæ³¨å†Œï¼ŒæœåŠ¡æ­£å¸¸å¯åŠ¨ |
| **å‰ç«¯ API å®¢æˆ·ç«¯é›†æˆ** | âœ… å®Œæˆ | index.vue å’Œ monitor.vue å·²å‡çº§ä½¿ç”¨æ–°çš„ apiClient v1.1 |
| **ç”Ÿäº§éƒ¨ç½²å‡†å¤‡** | âœ… éƒ¨åˆ† | å…³é”®ç«¯ç‚¹å·²å°±ç»ªï¼Œå‰©ä½™ç«¯ç‚¹å¾…è¿ç§» |

---

## ğŸ”§ ç¬¬äºŒæ¢¯é˜Ÿæ‰§è¡Œå†…å®¹

### 1. åç«¯å…³é”® API å‡çº§

#### 1.1 `backend/app.py` - `/health` ç«¯ç‚¹

**æ”¹è¿›å†…å®¹**:
- âœ… å®Œæ•´çš„ç³»ç»Ÿå¥åº·æ£€æŸ¥é€»è¾‘ï¼ˆå¿«é€Ÿå’Œæ·±åº¦æ£€æŸ¥æ¨¡å¼ï¼‰
- âœ… ä½¿ç”¨ç»Ÿä¸€çš„ `SuccessResponse` å’Œ `ErrorResponse` æ ¼å¼
- âœ… é›†æˆäº† AI æ¡¥æ¥ã€AI ä¸»æœºè¿æ¥æ€§æ£€æŸ¥
- âœ… åŒ…å«ç¼“å­˜å’Œæ•°æ®åº“æœåŠ¡å¥åº·æ£€æŸ¥
- âœ… æ”¯æŒå†å²å»¶è¿Ÿè®°å½•å’Œå¹³å‡è®¡ç®—

**ä»£ç ç¤ºä¾‹**:
```python
from backend.core.response import SuccessResponse, ErrorResponse, ErrorCode

@app.get("/health")
def get_health(fast: bool = False):
    try:
        info = {
            "status": "ok",
            "time": int(time.time()),
            "version": os.getenv("APP_VERSION", "dev"),
            # ... æ›´å¤šå­—æ®µ
        }
        
        if not fast:
            # AIä¸»æœºè¿æ¥æ€§æ£€æŸ¥...
            # ç¼“å­˜æœåŠ¡æ£€æŸ¥...
            # æ•°æ®åº“æœåŠ¡æ£€æŸ¥...
            pass
        
        return SuccessResponse(data=info, message="System is healthy")
    except Exception as e:
        return ErrorResponse(
            code=ErrorCode.INTERNAL_ERROR,
            message=f"Health check error: {str(e)}"
        )
```

**éªŒè¯ç»“æœ**:
```json
{
    "code": 0,
    "message": "System is healthy",
    "data": {
        "status": "ok",
        "time": 1767748971,
        "version": "dev",
        "deps": {"fastapi": "0.128.0", "uvicorn": "0.40.0"},
        "runtime": {"scripts_count": 9, "scheduler_max_parallel": 2}
    },
    "timestamp": "2026-01-07T01:22:51.206661"
}
```

#### 1.2 `backend/app.py` - `/scripts` ç«¯ç‚¹

**æ”¹è¿›å†…å®¹**:
- âœ… è¿ç§»åˆ°ç»Ÿä¸€çš„å“åº”æ ¼å¼
- âœ… è¿”å›è„šæœ¬åˆ—è¡¨å’Œè®¡æ•°
- âœ… å¢åŠ äº†ä¸­æ–‡æ–‡æ¡£å­—ç¬¦ä¸²

**éªŒè¯ç»“æœ**:
```json
{
    "code": 0,
    "message": "Retrieved 9 available scripts",
    "data": {
        "scripts": [
            "ai_agent", "ai_integration_tester", "ai_monitor",
            "ai_optimizer", "ai_task", "demo_run", "monitor",
            "page_probe", "phone_reverse"
        ],
        "count": 9
    },
    "timestamp": "2026-01-07T01:23:02.271642"
}
```

#### 1.3 `backend/app.py` - `/pages/{name}` é¡µé¢é‡å®šå‘

**æ”¹è¿›å†…å®¹**:
- âœ… ä¿ç•™åŸæœ‰åŠŸèƒ½ï¼Œæ”¯æŒæ— åç¼€é¡µé¢è®¿é—®

#### 1.4 å…¶ä»–æ”¹è¿›

- âœ… åˆ é™¤äº†å¯¹ `docs_router` çš„ç¡¬ç¼–ç å¼•ç”¨ï¼ˆå·²ç”± `register_routers()` åŠ¨æ€æ³¨å†Œï¼‰
- âœ… æ·»åŠ äº† `prometheus-client` å’Œ `structlog` ç¼ºå¤±ä¾èµ–

---

### 2. å‰ç«¯é›†æˆä¼˜åŒ–

#### 2.1 `frontend/src/pages/index.vue` - å‡çº§

**æ”¹è¿›å†…å®¹**:
- âœ… ä½¿ç”¨æ–°çš„ `apiClient` æ›¿ä»£åŸæœ‰çš„ `fetch`
- âœ… è‡ªåŠ¨æ”¯æŒé‡è¯•å’Œé”™è¯¯å¤„ç†
- âœ… æ­£ç¡®å¤„ç†æ–°çš„æ ‡å‡†å“åº”æ ¼å¼ (code/message/data)

**ä»£ç å˜åŒ–**:
```javascript
// âŒ æ—§æ–¹å¼
const response = await fetch('/api/functions')
if (!response.ok) throw new Error(`HTTP ${response.status}`)
const data = await response.json()

// âœ… æ–°æ–¹å¼
const { apiClient } = await import('@/api/client')
const response = await apiClient.get('/api/functions')  // è‡ªåŠ¨é‡è¯•ã€æ ‡å‡†æ ¼å¼å¤„ç†
let data = response?.data || response
```

#### 2.2 `frontend/src/pages/monitor.vue` - å‡çº§

**æ”¹è¿›å†…å®¹**:
- âœ… ä½¿ç”¨æ–°çš„ `apiClient` è·å–ç³»ç»Ÿå¥åº·çŠ¶æ€
- âœ… èƒ½å¤Ÿä» `/health?fast=true` è·å–è¿è¡Œæ—¶ä¿¡æ¯
- âœ… å¢å¼ºäº†é”™è¯¯å¤„ç†é€»è¾‘

**ä»£ç å˜åŒ–**:
```javascript
async loadMetrics() {
    try {
        const { apiClient } = await import('@/api/client')
        
        // è·å–ç³»ç»Ÿå¥åº·çŠ¶æ€ï¼ˆæ”¯æŒé‡è¯•ï¼‰
        const healthResponse = await apiClient.get('/health?fast=true')
        const healthData = healthResponse?.data || healthResponse
        
        this.systemStatus = healthData?.status === 'ok' ? 'healthy' : 'unhealthy'
        // ... æ›´å¤šåˆå§‹åŒ–é€»è¾‘
    } catch (err) {
        this.error = 'åŠ è½½ç›‘æ§æ•°æ®å¤±è´¥: ' + err.message
    }
}
```

---

## ğŸ“Š ç³»ç»ŸéªŒè¯ç»“æœ

### 3.1 åç«¯å¯åŠ¨éªŒè¯

```bash
$ python -m uvicorn backend.app:app --host 127.0.0.1 --port 8001

âœ… åç«¯å†…æ ¸åˆå§‹åŒ–æˆåŠŸ
âœ… å·²æ³¨å†Œè„šæœ¬: ai_agent, ai_integration_tester, ai_monitor, ... (å…±9ä¸ª)
âœ… å·²æ³¨å†Œè·¯ç”±: auth, base, pipeline, tasks, monitor, ... (å…±12ä¸ª)
âœ… åº”ç”¨å¯åŠ¨å®Œæˆ
```

### 3.2 API ç«¯ç‚¹æµ‹è¯•

| ç«¯ç‚¹ | æ–¹æ³• | çŠ¶æ€ | å“åº”æ ¼å¼ |
|------|------|------|---------|
| `/health?fast=true` | GET | âœ… 200 OK | æ ‡å‡†æ ¼å¼ (code/message/data) |
| `/health` | GET | âœ… 200 OK | æ ‡å‡†æ ¼å¼ï¼ŒåŒ…å«å®Œæ•´æ£€æŸ¥ |
| `/scripts` | GET | âœ… 200 OK | æ ‡å‡†æ ¼å¼ï¼Œå«è„šæœ¬åˆ—è¡¨ |

### 3.3 å“åº”æ ¼å¼éªŒè¯

æ‰€æœ‰æµ‹è¯•ç«¯ç‚¹å‡è¿”å›ç»Ÿä¸€æ ¼å¼:
```json
{
    "code": 0,                          // 0 = æˆåŠŸ, 1000+ = å®¢æˆ·ç«¯é”™è¯¯, 2000+ = æœåŠ¡å™¨é”™è¯¯
    "message": "Description",           // äººç±»å¯è¯»çš„æ¶ˆæ¯
    "data": { ... },                   // å®é™…è¿”å›æ•°æ®
    "timestamp": "ISO-8601 æ—¶é—´æˆ³",     // æœåŠ¡å™¨æ—¶é—´
    "request_id": null,                 // å¯é€‰ï¼šè¯·æ±‚è¿½è¸ªID
    "pagination": null                  // å¯é€‰ï¼šåˆ†é¡µä¿¡æ¯
}
```

---

## ğŸš€ ç”Ÿäº§éƒ¨ç½²æ£€æŸ¥æ¸…å•

### å¿…é¡»å®Œæˆçš„é¡¹

- [x] åç«¯å…³é”®ç«¯ç‚¹è¿ç§»åˆ°ç»Ÿä¸€å“åº”æ ¼å¼ (health, scripts)
- [x] å‰ç«¯å…³é”®é¡µé¢å‡çº§ä½¿ç”¨æ–°çš„ apiClient (index, monitor)
- [x] åç«¯æˆåŠŸå¯åŠ¨ï¼Œæ‰€æœ‰è·¯ç”±æ³¨å†Œ
- [x] API å¥åº·æ£€æŸ¥ç«¯ç‚¹æ­£å¸¸è¿è¡Œ
- [ ] è¿ç§»å‰©ä½™ 35+ ä¸ªåç«¯è·¯ç”±åˆ°æ ‡å‡†æ ¼å¼
- [ ] åœ¨ç”Ÿäº§ç¯å¢ƒæµ‹è¯•æ‰€æœ‰é¡µé¢çš„ API è°ƒç”¨
- [ ] æ›´æ–°åç«¯ API æ–‡æ¡£ (/docs)
- [ ] æ›´æ–°å‰ç«¯ç¯å¢ƒå˜é‡é…ç½® (.env.production)

### æ¨èä½†éå…³é”®çš„é¡¹

- [ ] æ·»åŠ  API å“åº”æ¨¡å¼ç‰ˆæœ¬å·ï¼ˆå¦‚ `apiVersion: "1.1"`ï¼‰
- [ ] ä¸ºå‰ç«¯ apiClient å¢åŠ ç¼“å­˜å±‚
- [ ] ä¸ºåç«¯å¢åŠ è¯·æ±‚æ—¥å¿—å’Œå®¡è®¡
- [ ] é…ç½® Prometheus ç›‘æ§æŒ‡æ ‡æ”¶é›†

---

## ğŸ“ˆ å½±å“åˆ†æ

### æ­£é¢å½±å“

1. **ä¸€è‡´æ€§**: æ‰€æœ‰ API å“åº”ç°åœ¨éµå¾ªç»Ÿä¸€çš„æ ¼å¼ï¼Œå‰ç«¯å¤„ç†é€»è¾‘ç®€åŒ–
2. **å¯é æ€§**: apiClient è‡ªåŠ¨é‡è¯•æœºåˆ¶æé«˜äº†ç½‘ç»œæ³¢åŠ¨ä¸‹çš„ç¨³å®šæ€§
3. **å¯ç»´æŠ¤æ€§**: é”™è¯¯ç ç»Ÿä¸€ç®¡ç†ï¼Œä¾¿äºè¿½è¸ªå’Œè°ƒè¯•
4. **ç›‘æ§èƒ½åŠ›**: `/health` ç«¯ç‚¹æä¾›äº†ç³»ç»ŸçŠ¶æ€çš„å®Œæ•´è§†å›¾

### éœ€è¦æ³¨æ„çš„ç‚¹

1. **å‘åå…¼å®¹**: å¦‚æœæœ‰å¤–éƒ¨ API è°ƒç”¨æ–¹ï¼Œéœ€è¦é€šçŸ¥å‡çº§å®¢æˆ·ç«¯
2. **æ€§èƒ½**: æ·±åº¦å¥åº·æ£€æŸ¥ (æ—  `fast=true` å‚æ•°) å¯èƒ½è¾ƒæ…¢ï¼Œå»ºè®®æœ‰è¶…æ—¶æ§åˆ¶
3. **å‰©ä½™å·¥ä½œ**: è¿˜æœ‰ 35+ ä¸ªè·¯ç”±éœ€è¦è¿ç§»åˆ°æ–°æ ¼å¼

---

## ğŸ“ åç»­æ‰§è¡Œæ­¥éª¤

### ç¬¬ä¸‰é˜¶æ®µ (Tier 3) - å³å°†å¯åŠ¨

1. **å®Œæˆ API å“åº”æ ¼å¼è¿ç§»**
   - æ‰¹é‡è¿ç§»å‰©ä½™ 35+ ä¸ªè·¯ç”±
   - ä¼˜å…ˆçº§: è®¤è¯ > ç®¡é“ > ä»»åŠ¡ > å…¶ä»–

2. **å‰ç«¯å…¨é¢é›†æˆ**
   - æ£€æŸ¥æ‰€æœ‰é¡µé¢æ˜¯å¦æ­£ç¡®ä½¿ç”¨ apiClient
   - éªŒè¯é”™è¯¯å¤„ç†é€»è¾‘
   - æ›´æ–°ç¯å¢ƒå˜é‡é…ç½®

3. **æµ‹è¯•è¦†ç›–**
   - å•å…ƒæµ‹è¯•: æµ‹è¯•æ–°çš„å“åº”æ ¼å¼
   - é›†æˆæµ‹è¯•: éªŒè¯å‰åç«¯äº¤äº’
   - E2E æµ‹è¯•: æ¨¡æ‹Ÿç”¨æˆ·åœºæ™¯

4. **éƒ¨ç½²å’Œç›‘æ§**
   - Docker é•œåƒæ„å»º
   - éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
   - ç›‘æ§æŒ‡æ ‡é‡‡é›†å’Œå‘Šè­¦è®¾ç½®

---

## ğŸ“š ç›¸å…³æ–‡ä»¶æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶

1. `backend/app.py` - å‡çº§ `/health` å’Œ `/scripts` ç«¯ç‚¹
2. `frontend/src/pages/index.vue` - é›†æˆæ–°çš„ apiClient
3. `frontend/src/pages/monitor.vue` - é›†æˆæ–°çš„ apiClient

### åˆ›å»ºçš„æ–‡ä»¶

æ— æ–°å¢æ–‡ä»¶ï¼ˆæ‰€æœ‰æ ¸å¿ƒç»„ä»¶å·²åœ¨ç¬¬ä¸€æ¢¯é˜Ÿåˆ›å»ºï¼‰

### ä¾èµ–é¡¹æ·»åŠ 

- `prometheus-client` - Prometheus ç›‘æ§æ”¯æŒ
- `structlog` - ç»“æ„åŒ–æ—¥å¿—ï¼ˆå·²å­˜åœ¨ä½†ç¼ºå¤±ï¼‰

---

## ğŸ¯ éªŒè¯æ–¹æ³•

### å¿«é€ŸéªŒè¯å‘½ä»¤

```bash
# 1. å¯åŠ¨åç«¯
cd /home/xiedaima/æ¡Œé¢/OOO/YLAI-AUTO-PLATFORM
. .venv/bin/activate
python -m uvicorn backend.app:app --host 127.0.0.1 --port 8001 &

# 2. ç­‰å¾…å¯åŠ¨ï¼ˆçº¦ 45 ç§’ï¼‰
sleep 45

# 3. æµ‹è¯• /health ç«¯ç‚¹
curl -s http://127.0.0.1:8001/health?fast=true | python -m json.tool | head -30

# 4. æµ‹è¯• /scripts ç«¯ç‚¹
curl -s http://127.0.0.1:8001/scripts | python -m json.tool | head -20

# 5. éªŒè¯ code=0 è¡¨ç¤ºæˆåŠŸ
echo "âœ… å¦‚æœä¸¤ä¸ªå“åº”çš„ code éƒ½æ˜¯ 0ï¼Œåˆ™éªŒè¯é€šè¿‡"
```

---

## ğŸ’¡ å…³é”®ä»£ç ç‰‡æ®µ

### ç»Ÿä¸€é”™è¯¯å¤„ç†æ¨¡å¼

```python
from backend.core.response import SuccessResponse, ErrorResponse, ErrorCode

# æˆåŠŸå“åº”
return SuccessResponse(
    data={"key": "value"},
    message="Operation successful"
)

# é”™è¯¯å“åº”
return ErrorResponse(
    code=ErrorCode.INTERNAL_ERROR,
    message="Something went wrong"
)

# å¸¦æ•°æ®çš„é”™è¯¯å“åº”
return ErrorResponse(
    code=ErrorCode.VALIDATION_ERROR,
    message="Invalid input",
    data={"errors": ["field1 is required"]}
)
```

### å‰ç«¯æ ‡å‡† API è°ƒç”¨æ¨¡å¼

```javascript
import { apiClient } from '@/api/client'

// è‡ªåŠ¨é‡è¯•ã€è¶…æ—¶æ§åˆ¶ã€æ ‡å‡†æ ¼å¼å¤„ç†
const response = await apiClient.get('/api/endpoint', {
    timeout: 5000,  // å¯é€‰ï¼šè¯·æ±‚è¶…æ—¶
    retries: 3      // å¯é€‰ï¼šé‡è¯•æ¬¡æ•°
})

// å“åº”å·²è‡ªåŠ¨å¤„ç†ï¼Œdata å°±æ˜¯è§£æåçš„æ•°æ®
console.log(response?.data)  // å®é™…æ•°æ®
console.log(response?.code)  // 0 = æˆåŠŸ
```

---

## ğŸ“ é—®é¢˜æ’æŸ¥

### Q: åç«¯å¯åŠ¨ç¼“æ…¢
A: è„šæœ¬æ‰«æå’ŒåŠ è½½éœ€è¦æ—¶é—´ï¼Œæ­£å¸¸å¯åŠ¨éœ€è¦ 40-50 ç§’ã€‚å¯ä»¥ä½¿ç”¨ `--reload` å‚æ•°åœ¨å¼€å‘æ—¶åŠ å¿«é‡å¯é€Ÿåº¦ã€‚

### Q: `/health` ç«¯ç‚¹è¿”å› `ai_bridge.available: false`
A: è¿™æ˜¯æ­£å¸¸çš„ï¼Œè¡¨ç¤º AI æ¨¡å‹æœåŠ¡æœªå¯åŠ¨ã€‚å¯ä»¥åœ¨ `docker-compose.yml` ä¸­é…ç½® Ollama æœåŠ¡æ¥å¯ç”¨ã€‚

### Q: å‰ç«¯é¡µé¢ä»ç„¶æ— æ³•åŠ è½½ API æ•°æ®
A: æ£€æŸ¥:
1. `.env.development` ä¸­ `VITE_API_BASE_URL` æ˜¯å¦æ­£ç¡®
2. æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ CORS é”™è¯¯
3. åç«¯å¥åº·æ£€æŸ¥æ˜¯å¦é€šè¿‡ (`curl http://127.0.0.1:8001/health`)

---

## âœ… æ£€æŸ¥æ¸…å•

æ‰§è¡Œå®Œæ¯•å‰ï¼Œè¯·ç¡®ä¿:

- [x] åç«¯ `/health` å’Œ `/scripts` ç«¯ç‚¹å·²è¿ç§»åˆ°ç»Ÿä¸€æ ¼å¼
- [x] å‰ç«¯ index.vue å’Œ monitor.vue å·²ä½¿ç”¨æ–°çš„ apiClient
- [x] åç«¯æœåŠ¡å·²æˆåŠŸå¯åŠ¨ï¼ˆæ— å¯¼å…¥é”™è¯¯ï¼‰
- [x] è‡³å°‘ä¸¤ä¸ª API ç«¯ç‚¹å·²éªŒè¯è¿”å›æ­£ç¡®æ ¼å¼
- [ ] æ‰€æœ‰ 35+ ä¸ªè·¯ç”±éƒ½å·²è¿ç§»ï¼ˆåç»­å·¥ä½œï¼‰
- [ ] å‰ç«¯æ‰€æœ‰é¡µé¢å·²æµ‹è¯•ï¼ˆåç»­å·¥ä½œï¼‰

---

## ğŸ“„ æ–‡æ¡£ç”Ÿæˆä¿¡æ¯

- **ç”Ÿæˆæ—¶é—´**: 2025-01-07 01:23 UTC
- **ç¯å¢ƒ**: Linux, Python 3.12, FastAPI 0.128, Vue.js 3.4
- **é¡¹ç›®**: YLAI-AUTO-PLATFORM v1.7.0
- **ç»´æŠ¤è€…**: GitHub Copilot

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [ç¬¬ä¸€æ¢¯é˜Ÿä¼˜åŒ–æ‰§è¡Œæ€»ç»“](ç¬¬ä¸€æ¢¯é˜Ÿä¼˜åŒ–æ‰§è¡Œæ€»ç»“.md)
- [å…¨å±€æ•´ç†ä¼˜åŒ–æŠ¥å‘Š](å…¨å±€æ•´ç†ä¼˜åŒ–æŠ¥å‘Š.md)
- [ç»Ÿä¸€æ¥å£æ˜ å°„è¡¨](ç»Ÿä¸€æ¥å£æ˜ å°„è¡¨.md)

